#
# Vigilant Canine Configuration Example
#
# This is a sample configuration file showing all available options with their
# default values. Copy this file to /etc/vigilant-canine/config.toml and customize
# as needed.
#
# SPDX-License-Identifier: GPL-3.0-or-later
# Copyright (c) 2026 Tony Walker
#

[daemon]
# Log level: trace, debug, info, warn, error
log_level = "info"

# Database path for storing baselines and alerts
db_path = "/var/lib/vigilant-canine/vc.db"

# Worker threads (0 = auto-detect based on CPU cores)
worker_threads = 0

[hash]
# Hash algorithm: blake3 (only blake3 is currently supported)
algorithm = "blake3"

[monitor.system]
# Additional system paths to monitor (beyond package-managed files)
# These paths are monitored for unauthorized changes
paths = [
    "/etc",
    "/boot",
    "/usr/local/bin",
    "/usr/local/sbin",
]

# Paths to exclude from monitoring (supports globs)
exclude = [
    "/etc/machine-id",
    "/etc/hostname",
    "/etc/resolv.conf",
    "/etc/shadow",
    "/etc/shadow-",
    "/etc/passwd-",
    "/etc/group-",
    "/etc/gshadow-",
]

# [monitor.flatpak]
# # PLANNED FEATURE - Not yet implemented
# # Monitor Flatpak applications for tampering
# enabled = false
# system = true
# user = false

# [monitor.ostree]
# # PLANNED FEATURE - Not yet implemented
# # Monitor OSTree deployments (for rpm-ostree/Fedora Silverblue systems)
# enabled = false
# verify_deployments = true
# monitor_object_store = true

[monitor.home]
# Monitor user home directories (disabled by default for privacy)
enabled = false

# Specific paths in home directories to monitor
# Only used if monitor.home.enabled = true
paths = [
    "~/.ssh",
    "~/.gnupg",
]

# Exclude patterns for home directory monitoring
exclude = [
    "~/.cache",
    "~/.local/share/Trash",
]

[alerts]
# Log alerts to systemd journal
journal = true

# Send desktop notifications via D-Bus
dbus = true

# Make alerts available via Unix domain socket
# (for API daemon and dashboard)
socket = true

[scan]
# Perform full baseline scan on boot
on_boot = true

# Interval between full scan cycles (hours)
interval_hours = 24

# Number of files to verify per batch (0 = auto-calculate to spread work evenly)
batch_size = 0

# Adjust verification pacing based on AC vs battery power
adaptive_pacing = true

# Slowdown factor when on battery power (multiplies sleep between batches)
battery_slowdown_factor = 2.0

# Pause verification when battery level drops below this percentage
battery_pause_threshold = 20

[journal]
# Enable systemd journal monitoring
enabled = true

# Maximum journal priority to process (0=emerg, 7=debug, default=6=info)
max_priority = 6

# Units to exclude from monitoring (e.g., noisy services)
exclude_units = []

# Identifiers to exclude from monitoring
exclude_identifiers = ["vigilant-canined"]

# Custom journal rules (beyond the built-in defaults)
# Built-in rules cover: auth failures, privilege escalation, service failures,
# kernel errors, OOM events
# rules = []

[correlation]
# Enable event correlation
enabled = true

# Default correlation window in seconds
window_seconds = 300

# Correlation rules for threshold-based alerting
# Example: escalate repeated auth failures
# [[correlation.rules]]
# name = "repeated_auth_failure"
# event_match = "auth_failure"
# threshold = 5
# window_seconds = 60
# escalated_severity = "critical"

[audit]
# Enable Linux audit subsystem monitoring
enabled = true

# Sanitize command lines to prevent credential exposure
sanitize_command_lines = true

# Exclude specific commands from monitoring
exclude_comms = []

# Exclude specific UIDs from monitoring
exclude_uids = []

# Custom audit rules (beyond the built-in defaults)
# Built-in rules cover: privilege escalation, sensitive file access,
# suspicious network connections, kernel module loading
# rules = []

[policy.home]
# Force monitoring for specific users (cannot opt out)
monitor_users = []

# Force monitoring for users in these groups
monitor_groups = []

# Allow users to opt out of monitoring (only if not in monitor_users/groups)
allow_user_opt_out = true

# Mandatory paths that must be monitored for all monitored users
# Users can add more paths but cannot remove these
mandatory_paths = []
